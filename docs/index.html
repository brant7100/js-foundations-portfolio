<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
async function loadList() {
  const ul = document.getElementById('log-list');
  try {
    const res = await fetch('./logs.json?_=' + Date.now());
    const data = await res.json();

    if (!data.items || data.items.length === 0) {
      ul.innerHTML = '<li>등록된 로그가 없습니다.</li>';
      return;
    }

    ul.innerHTML = data.items
      .sort((a, b) => (a.date < b.date ? 1 : -1))
      .map(item => {
        const tags = (item.tags || [])
          .map(t => '<span class="tag">' + t + '</span>')
          .join('');
        return (
          '<li data-path="' + item.path + '">' +
            '<div><strong>' + item.title + '</strong></div>' +
            '<div class="muted">' + item.date + '</div>' +
            '<div>' + tags + '</div>' +
          '</li>'
        );
      })
      .join('');

    ul.querySelectorAll('li').forEach(li => {
      li.addEventListener('click', () => loadMarkdown(li.dataset.path));
    });

  } catch (err) {
    console.error(err);
    ul.innerHTML = '<li>⚠️ logs.json을 불러올 수 없습니다.</li>';
  }
}

async function loadMarkdown(path) {
  const viewer = document.getElementById('viewer');
  try {
    const res = await fetch(path + '?_=' + Date.now());
    const md = await res.text();
    viewer.innerHTML = marked.parse(md);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } catch (err) {
    console.error(err);
    viewer.innerHTML = '<p>⚠️ 마크다운 파일을 불러올 수 없습니다.</p>';
  }
}

loadList();
</script>
